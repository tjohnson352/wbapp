{% extends "base.html" %}

{% block title %}My Account{% endblock %}

{% block header %}
{% endblock %}

{% block content %}

<div class="dashboard-menu">
    <ul class="menu-list">
        <li><a href="/dashboard">Dashboard</a></li>
        <li><a href="/">Upload Schedule</a></li>
        <li><a href="/account" class="active">My Account</a></li>
        <li><a href="/logout" class="logout">Logout</a></li>
    </ul>
</div>


    <!-- Card 1: Basic user info -->
    <div class="card">
        <div class="account-container">
            <h2>The Schedulizer <span>My account</span></h2>
        </div>
        <h3>User Information</h3>
        <div class="row">
            <label>Account Created:</label>
            <p>{{ user.created_at }}</p>
        </div>
        <div class="row">
            <label>Last Updated:</label>
            <p>{{ user.updated_at }}</p>
        </div>
        <div class="row">
            <label>Name:</label>
            <p>{{ user.first_name|capitalize }} {{ user.last_name|capitalize }}</p>
        </div>
        <div class="row">
            <label>Email:</label>
            <p>{{ user.login_id }}</p>
        </div>
        <button id="editEmailBtn" class="btn-secondary">Change email</button>
          <form id="editEmailForm" class="hidden" method="POST" action="/update_email">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <input type="email" name="new_email" id="new_email" placeholder="Enter new email" class="file-input" required>
              <button type="submit" class="btn-primary">Save Email</button>
          </form>
    </div>

     <!-- Card 2: Workplace info -->
     <div class="card">
        <h3>Workplace Information</h3>
        <div class="row">
            <label>School/Workplace:</label>
            <p>{{ user.school_name }}</p>
        </div>
        <div class="row">
            <label>Middle Manager:</label>
            <p>{{ user.middle_manager }}</p>
        </div>  
        <div class="row">
            <label>Work Percentage:</label>
            <p>{{ user.work_percent }}</p>
        </div>
        
        <div class="row">
            <label>Privacy consent:</label>
            <p>{{ user.consent }}</p>
        </div>
    </div>
    
    <!-- Card 3: Membership/roles -->
    <div class="card">
        <h3>Sveriges Lärare Membership and Roles</h3>
        <table class="roles-table">
            <thead>
                <tr>
                    <th>Role</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Registered Member</td>
                    <td class="{{ 'status' if user.sl_member == 'Yes' else '' }}">{{ user.sl_member }}</td>
                </tr>
                <tr>
                    <td>Lokalombud</td>
                    <td class="{{ 'status' if user.lokalombud == 'Yes' else '' }}">{{ user.lokalombud }}</td>
                </tr>
                <tr>
                    <td>Skyddsombud</td>
                    <td class="{{ 'status' if user.skyddsombud == 'Yes' else '' }}">{{ user.skyddsombud }}</td>
                </tr>
                <tr>
                    <td>Förhandlingsombud</td>
                    <td class="{{ 'status' if user.forhandlingsombud == 'Yes' else '' }}">{{ user.forhandlingsombud }}</td>
                </tr>
                <tr>
                    <td>Huvudskyddsombud</td>
                    <td class="{{ 'status' if user.huvudskyddsombud == 'Yes' else '' }}">{{ user.huvudskyddsombud }}</td>
                </tr>
                <tr>
                    <td>Styrelseledamot</td>
                    <td class="{{ 'status' if user.styrelseledamot == 'Yes' else '' }}">{{ user.styrelseledamot }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Security Settings -->
    <!-- Card 4: Security Settings -->
    <div class="card">
        <h3>Security Settings</h3>
    <!-- Change Password Section -->
    <div class="row">
        <button id="changePasswordBtn" class="btn-secondary">Change password</button>
        <form id="changePasswordForm" class="hidden" method="POST" action="/update_password">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <label>Current Password:</label>
            <input type="password" name="current_password" id="current_password" class="file-input" required>

            <label>New Password:</label>
            <input type="password" name="new_password" id="new_password" class="file-input" required>

            <label>Verify New Password:</label>
            <input type="password" id="verify_password" class="file-input" required>

            <div class="row">
                <input type="checkbox" id="show-password-toggle">
                <label for="show-password-toggle">Show Passwords</label>
            </div>

            <button type="submit" class="btn-primary">Save Password</button>
        </form>
    </div>

    <!-- Update Security Questions Section -->
    <div class="row">
        <button id="updateSecurityBtn" class="btn-secondary">Update security questions</button>
        <form id="updateSecurityForm" class="hidden" method="POST" action="/update_security_questions">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <div class="row">
                <select name="security_question_1" id="security_question_1" required>
                    <option value="{{ user.security_question_1 }}" selected>{{ user.security_question_1 }}</option>
                    {% for question in security_questions %}
                        <option value="{{ question }}">{{ question }}</option>
                    {% endfor %}
                </select>
                <input type="text" name="security_answer_1" class="file-input" placeholder="Answer" required>
            </div>
    
            <div class="row">
                <select name="security_question_2" id="security_question_2" required>
                    <option value="{{ user.security_question_2 }}" selected>{{ user.security_question_2 }}</option>
                    {% for question in security_questions %}
                        <option value="{{ question }}">{{ question }}</option>
                    {% endfor %}
                </select>
                <input type="text" name="security_answer_2" class="file-input" placeholder="Answer" required>
            </div>
    
            <div class="row">
                <select name="security_question_3" id="security_question_3" required>
                    <option value="{{ user.security_question_3 }}" selected>{{ user.security_question_3 }}</option>
                    {% for question in security_questions %}
                        <option value="{{ question }}">{{ question }}</option>
                    {% endfor %}
                </select>
                <input type="text" name="security_answer_3" class="file-input" placeholder="Answer" required>
            </div>
            <button type="submit" class="btn-primary">Save Security Questions</button>
        </form>
    </div>

    <!-- Footer buttons -->
    <div class="button-container">
        <a href="/dashboard" class="btn-primary">Go to Dashboard</a>
        <a href="/logout" class="btn-secondary logout-btn">Logout</a>
    </div>
</div>

<script>
    document.getElementById("editEmailBtn").addEventListener("click", function() {
        document.getElementById("editEmailForm").classList.toggle("hidden");
    });

    document.getElementById("changePasswordBtn").addEventListener("click", function() {
        document.getElementById("changePasswordForm").classList.toggle("hidden");
    });

    document.getElementById("updateSecurityBtn").addEventListener("click", function() {
        document.getElementById("updateSecurityForm").classList.toggle("hidden");
    });

    // Password visibility toggle
    document.getElementById("show-password-toggle").addEventListener("change", function() {
        let passwordFields = ["current_password", "new_password", "verify_password"];
        passwordFields.forEach(id => {
            let field = document.getElementById(id);
            field.type = this.checked ? "text" : "password";
        });
    });

    
    // Verify new password match
    document.getElementById("changePasswordForm").addEventListener("submit", function(event) {
        let newPassword = document.getElementById("new_password").value;
        let verifyPassword = document.getElementById("verify_password").value;
        if (newPassword !== verifyPassword) {
            alert("New passwords do not match.");
            event.preventDefault();
        }
    });
</script>

{% endblock %}

{% block extra_styles %}
<style>

  
    /* Container */
    .account-container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem;
      text-align: center;
      
    }
  
    /* Headings */
    h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    h2 span {
      font-weight: 300;
      color: #666;
    }
    h3 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid #ccc;
      padding-bottom: 0.5rem;
    }
  
    /* Cards */
    .card {
      background-color: #fff;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      padding: 1.5rem;
      margin-bottom: 1rem;
    }
  
    /* Rows in the card */
    .row {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .row label {
      width: 150px;
      font-weight: 600;
    }
    .row p {
      margin: 0;
    }
  
    /* Buttons */
    .btn-primary,
    .btn-secondary,
    .logout-btn {
      display: inline-block;
      padding: 0.5rem 1rem;
      font-size: 0.95rem;
      border-radius: 4px;
      text-decoration: none;
      cursor: pointer;
      text-align: center;
      transition: background 0.3s ease;
      margin-right: 0.5rem;
      margin-bottom: 1rem
    }
  
    .btn-primary {
      background-color: #0275d8;
      color: #fff;
      border: none;
    }
    .btn-primary:hover {
      background-color: #025aa5;
    }
  
    .btn-secondary {
      background: #ddd;
      color: #333;
      border: none;
    }
    .btn-secondary:hover {
      background: #bbb;
    }
  
    .logout-btn {
      background: #d9534f;
      color: white;
    }
    .logout-btn:hover {
      background: #c9302c;
    }
  
    /* Hidden class for toggling forms */
    .hidden {
      display: none;
    }
  
    /* Tables */
    .roles-table {
      width: 100%;
      border-collapse: collapse;
      border: 1px solid #ddd;
      background-color: #fff;
    }
    .roles-table th {
      background-color: #0275d8;
      color: #fff;
      text-align: left;
      padding: 0.75rem;
    }
    .roles-table td {
      padding: 0.75rem;
      border: 1px solid #ddd;
      font-size: 0.95rem;
    }
    .roles-table tr:hover {
      background-color: #f2f2f2;
    }
  
    /* Form styling */
    form label {
      display: block;
      margin-bottom: 0.25rem;
      font-weight: 600;
    }

  
    /* (Optional) Transition-based hide/show if desired:
    .hidden {
      height: 0;
      overflow: hidden;
      transition: height 0.3s ease;
    }
    */
  </style>
  
{% endblock %}

